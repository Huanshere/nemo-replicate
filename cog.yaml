# ───── cog.yaml ──────────────────────────────────────────────────────────────
build:
  gpu: true
  cuda: "11.8"
  system_packages:
    - "ffmpeg"
  python_version: "3.10"
  run:
    # ─ 基础依赖 ─
    - "pip install --no-cache-dir torch torchvision torchaudio"
    # NeMo 最新源码（ASR）
    - "pip install nemo_toolkit[asr]"
    - "pip uninstall nemo_toolkit -y"
    - "pip install --no-cache-dir git+https://github.com/NVIDIA/NeMo.git@main"
    # 其余依赖
    - "pip install --no-cache-dir pydub numpy==1.24.3 pandas"
    # ─ Speaker Diarization ─
    - "pip install --no-cache-dir 'pyannote.audio>=3.1'"
    # ─ 预下载模型权重 ─
    - |
      python - << 'PY'
      import os
      import nemo.collections.asr as nemo_asr
      from pyannote.audio import Pipeline

      # NeMo ASR
      nemo_asr.models.ASRModel.from_pretrained(model_name="nvidia/parakeet-tdt-0.6b-v2")

      # Pyannote speaker‑diarization
      Pipeline.from_pretrained("pyannote/speaker-diarization-3.1",
                                use_auth_token="hf_token")
      PY
predict: "predict.py:Predictor"
